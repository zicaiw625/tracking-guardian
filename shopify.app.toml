# Tracking Guardian - Post-purchase Tracking Health Monitor
# Learn more at https://shopify.dev/docs/apps/tools/cli/configuration
#
# IMPORTANT: Before deploying, update the following:
# 1. client_id - Get from Shopify Partners Dashboard after creating your app
# 2. application_url - Your deployed app URL (e.g., https://tracking-guardian.onrender.com)
# 3. redirect_urls - Update with your app URL
# 4. dev_store_url - Your development store URL

name = "Tracking Guardian"
# Replace with your actual client_id from Shopify Partners
client_id = "${SHOPIFY_API_KEY}"
# Replace with your deployed app URL
application_url = "${SHOPIFY_APP_URL}"
embedded = true

[access_scopes]
# Learn more at https://shopify.dev/docs/apps/tools/cli/configuration#access_scopes
# 
# Scope justification:
# - read_orders: Required for webhook order data and reconciliation reports
# - read_script_tags: Required for migration scanning (detecting old tracking scripts)
# - write_pixels: Required to create/manage the Web Pixel extension
# - read_customer_events: Required to receive customer event data via Web Pixel
#
# Note: read_checkouts removed (P3-1) - checkout data comes via Web Pixel events,
# not via Admin API. This reduces our permission footprint for App Review.
scopes = "read_orders,read_script_tags,write_pixels,read_customer_events"

[auth]
# Update these URLs with your deployed app URL
redirect_urls = [
  "${SHOPIFY_APP_URL}/auth/callback",
  "${SHOPIFY_APP_URL}/auth/shopify/callback",
  "${SHOPIFY_APP_URL}/api/auth/callback"
]

[webhooks]
api_version = "2024-10"

# Mandatory compliance webhooks (app-level subscription)
# Business webhooks (orders/paid, app/uninstalled) are managed via code in shopify.server.ts
# to avoid duplicate deliveries
[[webhooks.subscriptions]]
compliance_topics = ["customers/data_request", "customers/redact", "shop/redact"]
uri = "/webhooks"

[pos]
embedded = false

[build]
automatically_update_urls_on_dev = true
# Update with your development store URL
dev_store_url = "${SHOPIFY_DEV_STORE_URL}"

