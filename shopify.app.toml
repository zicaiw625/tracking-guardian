name = "Tracking Guardian"
client_id = "00abdc5a393d94902ada694e9cb85e5f"
application_url = "https://tracking-guardian.onrender.com"
embedded = true

[access_scopes]
# Note: write_script_tags removed - blocked by Shopify from 2025-02-01 on checkout pages
# P0-4: v1.0 版本需要 read_orders scope 以支持 Reorder 功能（查询订单 line items）
# Reorder 功能是 v1.0 模块库的核心功能之一，需要读取订单信息以构建再购链接
# If you still need ScriptTag scanning, keep read_script_tags; remove it if not needed
scopes = "read_script_tags,read_pixels,write_pixels,read_customer_events,read_orders"

[auth]
redirect_urls = [
  "https://tracking-guardian.onrender.com/auth/callback",
  "https://tracking-guardian.onrender.com/auth/shopify/callback",
  "https://tracking-guardian.onrender.com/api/auth/callback"
]

[webhooks]
api_version = "2025-07"

# P0-01: App lifecycle webhook (required for data cleanup on uninstall)
[[webhooks.subscriptions]]
topics = ["app/uninstalled"]
uri = "/webhooks"

# GDPR compliance webhooks (mandatory)
[[webhooks.subscriptions]]
compliance_topics = ["customers/data_request", "customers/redact", "shop/redact"]
uri = "/webhooks"

# P0-2: 订单/退款 webhooks（用于 Verification 和 Reconciliation）
# 注意：这些 webhooks 仅存储订单摘要信息（orderId, orderNumber, totalValue, currency, financialStatus）
# 不存储任何 PII（邮箱/地址/电话），符合 v1.0 隐私最小化原则
[[webhooks.subscriptions]]
topics = ["orders/create", "orders/updated", "orders/cancelled", "orders/edited"]
uri = "/webhooks"

[[webhooks.subscriptions]]
topics = ["refunds/create"]
uri = "/webhooks"

[pos]
embedded = false

[build]
automatically_update_urls_on_dev = true
# dev_store_url: Shopify CLI 会在首次运行 `shopify app dev` 时自动提示选择开发商店
# 如需手动指定，格式为: dev_store_url = "your-store.myshopify.com"
