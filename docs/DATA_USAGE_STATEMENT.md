# 数据使用说明

**最后更新**: 2024年12月

本文档说明 Checkout 升级助手（Checkout Migration Hub）如何收集、使用和保护数据。

## 数据收集目的

### 1. 核心功能所需数据

我们收集以下数据以提供应用的核心功能：

| 数据类型 | 收集目的 | 是否必需 |
|---------|---------|---------|
| 订单信息（订单ID、金额、币种） | 发送转化事件到广告平台，进行事件对账 | ✅ 必需 |
| ScriptTags 和 Additional Scripts 内容 | 扫描和识别需要迁移的追踪代码 | ✅ 必需 |
| Web Pixel 配置 | 创建和管理 App Pixel Extension | ✅ 必需 |
| 事件发送日志 | 监控事件发送状态，提供对账报告 | ✅ 必需 |

### 2. 我们不收集的数据

我们**明确不收集**以下数据：
- ❌ 客户邮箱地址（不会发送到广告平台）
- ❌ 客户姓名或地址（不会发送到广告平台）
- ❌ 客户电话号码（不会发送到广告平台）
- ❌ 支付信息
- ❌ 浏览历史或页面浏览数据
- ❌ 购物车内容（除非是转化事件）

## 数据使用方式

### 1. 转化事件发送

当商家配置了服务器端追踪（CAPI）时，我们会在客户同意的情况下，将订单数据发送到以下平台：

- **Google Analytics 4 (GA4)**: 用于转化测量
- **Meta (Facebook/Instagram)**: 用于广告归因
- **TikTok**: 用于广告归因
- **Pinterest**: 用于广告归因

**发送的数据**：
- 事件类型（purchase）
- 订单金额和币种
- 商品信息（产品ID、数量）
- 事件时间戳
- 事件ID（用于去重）

**不发送的数据**：
- 客户个人信息（邮箱、姓名、地址、电话）
- 支付信息

### 2. 事件去重

我们使用事件ID（event_id）来防止同一订单的事件被重复发送到广告平台。这确保了转化数据的准确性。

### 3. 数据对账

我们比较 Shopify 订单数据和广告平台接收到的转化事件，生成对账报告，帮助商家验证追踪配置是否正确。

### 4. 监控和告警

我们监控事件发送的成功率、失败率和参数完整性，在出现异常时发送告警通知。

## 数据存储

### 存储位置

- 数据存储在商家选择的云服务提供商（如 Render、Railway 等）
- 商家可以自行选择数据库服务提供商

### 数据保留

- **默认保留期**: 90天
- **可配置范围**: 30-365天
- **自动删除**: 超过保留期的数据会自动删除
- **卸载删除**: 应用卸载后，所有数据会在48小时内删除

## 数据安全

### 加密

- 所有敏感凭证（API密钥、访问令牌）使用 AES-256-GCM 加密存储
- 传输过程中使用 HTTPS/TLS 加密

### 访问控制

- 所有API端点需要有效的 Shopify 会话令牌
- Webhook 请求通过 HMAC 签名验证
- 多租户数据隔离

## 第三方服务

### 使用的第三方服务

我们可能使用以下第三方服务来提供功能：

| 服务 | 用途 | 数据共享 |
|------|------|---------|
| Shopify Admin API | 获取订单数据、管理配置 | 仅订单元数据 |
| 广告平台 API | 发送转化事件 | 仅订单和商品数据 |
| 邮件服务（Resend） | 发送告警通知 | 仅商家邮箱地址 |
| 云服务提供商 | 托管应用和数据库 | 所有应用数据 |

### 数据共享限制

我们**不会**：
- 将数据出售给第三方
- 将数据用于广告定向（除非商家明确配置）
- 将数据用于除转化追踪外的其他目的

## 客户同意

### 同意要求

我们遵循 Shopify 的 Customer Privacy API，仅在以下情况下处理数据：

1. **Analytics + Marketing 同意**: 可以发送转化事件到广告平台
2. **仅 Analytics 同意**: 不发送数据到广告平台
3. **仅 Marketing 同意**: 不发送数据到广告平台
4. **Sale of Data 退出**: 不发送数据到广告平台

### 同意管理

- 我们通过 Shopify 的 Customer Privacy API 获取同意状态
- 我们尊重客户的同意选择
- 如果客户撤回同意，我们不会发送新的转化事件

## GDPR 合规

### 数据主体权利

根据 GDPR，客户有权：

1. **访问权**: 通过 `customers/data_request` webhook 请求数据
2. **删除权**: 通过 `customers/redact` webhook 请求删除数据
3. **可携带权**: 数据以 JSON 格式导出

### 我们的响应

- 数据请求：在30天内完成
- 数据删除：立即处理，永久删除
- 数据导出：提供完整的 JSON 格式数据

## 商家责任

使用本应用的商家需要：

1. **告知客户**: 向客户说明使用了服务器端转化追踪
2. **获得同意**: 确保在目标市场获得适当的客户同意
3. **遵守法规**: 遵守适用的隐私法规（GDPR、CCPA等）
4. **配置保留期**: 根据业务需求配置适当的数据保留期

## 联系我们

如有关于数据使用的疑问，请通过以下方式联系我们：

- **应用内支持**: 在 Shopify Admin 中的应用页面
- **Shopify Partner Dashboard**: 通过合作伙伴仪表板联系

---

*本文档符合 Shopify App Store 审核要求，并定期更新以反映最新的数据使用实践。*

