# 故障排除指南

## 常见问题与解决方案

### 1. 扫描相关问题

#### Q: 扫描结果显示"无风险项"，但我确定有 ScriptTags

**可能原因**:
- ScriptTags 不在订单状态页（order_status）
- API 权限不足
- ScriptTags 已被其他应用管理

**解决方案**:
1. 检查 Shopify Admin → Settings → Customer events 中的 ScriptTags
2. 确认应用有 `read_script_tags` 权限
3. 手动粘贴 Additional Scripts 内容进行分析

#### Q: 扫描时间过长

**可能原因**:
- 店铺 ScriptTags 数量较多
- 网络延迟

**解决方案**:
- 等待扫描完成（通常不超过 2 分钟）
- 如超过 5 分钟仍未完成，刷新页面重试

### 2. 像素迁移问题

#### Q: 配置保存后事件未发送

**检查清单**:
1. ✅ 确认像素已启用（迁移页面显示"已安装"）
2. ✅ 确认环境已切换到"生产模式"（如需要）
3. ✅ 检查凭证是否正确
4. ✅ 查看监控页面的事件日志

**解决方案**:
- 查看「监控」页面的错误详情
- 检查凭证是否过期
- 验证事件映射配置是否正确

#### Q: Meta Test Event Code 验证失败

**可能原因**:
- Test Event Code 格式错误
- Test Event Code 已过期
- 事件未发送到测试端点

**解决方案**:
1. 确认 Test Event Code 格式：`TEST` + 数字（如 `TEST12345`）
2. 在 Meta Events Manager 中生成新的 Test Event Code
3. 更新配置后重新验证

#### Q: GA4 DebugView 中看不到事件

**可能原因**:
- Measurement ID 配置错误
- API Secret 配置错误
- 事件未成功发送

**解决方案**:
1. 确认 Measurement ID 格式：`G-XXXXXXXXXX`
2. 确认 API Secret 正确
3. 在「监控」页面查看发送状态
4. 检查 GA4 DebugView 的实时事件流

### 3. 事件对账问题

#### Q: 事件金额与订单金额不一致

**可能原因**:
- 折扣未正确计算
- 运费未包含
- 币种转换问题

**解决方案**:
1. 检查订单详情中的折扣和运费
2. 确认币种设置正确
3. 查看事件详情中的 `value` 和 `currency` 参数

#### Q: 事件参数缺失

**可能原因**:
- 事件映射配置不完整
- 平台不支持某些参数
- 订单数据不完整

**解决方案**:
1. 检查事件映射配置
2. 查看平台文档确认支持的参数
3. 在「验收」页面查看详细的参数检查结果

### 4. 监控告警问题

#### Q: 收到"事件失败率过高"告警

**可能原因**:
- API 凭证过期
- 平台 API 限流
- 网络问题

**解决方案**:
1. 检查凭证是否有效
2. 查看「监控」页面的错误详情
3. 检查平台 API 状态
4. 如持续失败，联系平台支持

#### Q: 告警未触发

**可能原因**:
- 告警阈值设置过高
- 告警渠道配置错误
- 告警频率设置不当

**解决方案**:
1. 检查告警配置（设置 → 告警）
2. 确认告警渠道（邮件/Slack/Telegram）配置正确
3. 调整告警阈值和频率

### 5. UI 模块问题

#### Q: Thank you 页面模块未显示

**检查清单**:
1. ✅ 确认模块已启用
2. ✅ 确认显示规则配置正确
3. ✅ 确认目标页面（Thank you / Order status）正确
4. ✅ 确认套餐支持该模块

**解决方案**:
- 检查模块配置（UI 模块页面）
- 确认显示规则中的条件（订单金额、客户标签等）
- 在开发商店中测试模块显示

#### Q: 模块样式不正确

**可能原因**:
- 主题样式冲突
- 模块配置错误

**解决方案**:
- 检查模块的显示规则配置
- 联系支持获取自定义样式支持

### 6. Agency 功能问题

#### Q: 批量扫描失败

**可能原因**:
- 部分店铺权限不足
- 网络问题
- 店铺数量过多

**解决方案**:
1. 查看批量任务详情中的错误信息
2. 检查失败店铺的权限
3. 分批执行批量操作

#### Q: 批量应用模板失败

**可能原因**:
- 模板配置错误
- 目标店铺配置冲突
- 权限不足

**解决方案**:
1. 检查模板配置
2. 查看应用结果详情
3. 确认目标店铺有足够权限

### 7. 性能问题

#### Q: 页面加载缓慢

**可能原因**:
- 数据量过大
- 网络延迟
- 浏览器缓存问题

**解决方案**:
- 清除浏览器缓存
- 检查网络连接
- 联系支持优化查询

#### Q: Checkout Extension 加载缓慢

**可能原因**:
- 模块配置复杂
- 网络请求过多

**解决方案**:
- 简化模块配置
- 减少不必要的网络请求
- 使用延迟加载

## 诊断工具

### 1. 应用内诊断

进入「诊断」页面（`/app/diagnostics`）可以：

- 查看系统状态
- 检查配置完整性
- 查看最近的错误日志
- 运行健康检查

### 2. 监控页面

「监控」页面提供：

- 事件发送成功率
- 错误详情和原因
- 事件趋势图表
- 平台状态监控

### 3. 验收页面

「验收」页面可以：

- 实时查看事件触发
- 检查参数完整性
- 验证金额准确性
- 导出验收报告

## 获取帮助

如果以上解决方案无法解决您的问题：

1. **查看日志**: 在「诊断」页面查看详细错误信息
2. **联系支持**: 通过应用内支持入口提交工单
3. **查看文档**: 参考完整用户指南和 API 文档

## 错误代码参考

| 错误代码 | 含义 | 解决方案 |
|---------|------|---------|
| `INVALID_CREDENTIALS` | 凭证无效 | 检查并更新 API 凭证 |
| `RATE_LIMIT_EXCEEDED` | 请求频率过高 | 等待后重试 |
| `PLATFORM_ERROR` | 平台 API 错误 | 查看平台状态，联系平台支持 |
| `MISSING_PARAMS` | 参数缺失 | 检查事件映射配置 |
| `CONSENT_REQUIRED` | 需要同意 | 确认客户同意状态 |

