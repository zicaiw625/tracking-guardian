# Checkout 迁移完整指南

**最后更新**: 2024年12月

本指南帮助 Shopify 商家从旧版 Checkout 系统迁移到 Checkout Extensibility，使用 Checkout 升级助手完成整个迁移过程。

## 目录

1. [迁移概述](#迁移概述)
2. [迁移前准备](#迁移前准备)
3. [迁移步骤](#迁移步骤)
4. [迁移后验证](#迁移后验证)
5. [常见问题](#常见问题)
6. [故障排除](#故障排除)

---

## 迁移概述

### 什么是 Checkout Extensibility？

Checkout Extensibility 是 Shopify 的新结账系统，提供：
- **Web Pixels**: 客户端事件追踪
- **UI Extensions**: 自定义结账页面元素
- **Server-Side API**: 服务器端事件发送

### 为什么需要迁移？

- **旧系统即将停用**: ScriptTags 和 Additional Scripts 将在 2026 年停止支持
- **更好的性能**: 新系统提供更好的性能和用户体验
- **更多功能**: 支持更多自定义和扩展功能

### 迁移时间表

| 商家类型 | 截止日期 | 状态 |
|---------|---------|------|
| Shopify Plus | 2026年1月 | ⚠️ 即将到期 |
| 非 Plus 商家 | 2026年8月26日 | ⏳ 进行中 |

---

## 迁移前准备

### 1. 了解当前状态

在开始迁移前，您需要了解：

- **当前使用的追踪平台**: GA4、Meta Pixel、TikTok Pixel 等
- **追踪代码位置**: ScriptTags、Additional Scripts、checkout.liquid
- **自定义功能**: 问卷、追踪显示、再购按钮等

### 2. 使用扫描功能

1. 打开应用，进入 **扫描** 页面
2. 点击 **开始扫描**
3. 等待扫描完成（通常 1-2 分钟）
4. 查看扫描报告，了解需要迁移的项目

### 3. 准备 API 凭证

迁移需要以下平台的 API 凭证：

#### Google Analytics 4 (GA4)
- **Measurement ID**: `G-XXXXXXXXXX`
- **API Secret**: 在 GA4 管理后台创建

#### Meta (Facebook/Instagram)
- **Pixel ID**: 在 Meta Events Manager 中获取
- **Access Token**: 在 Meta Business Settings 中创建

#### TikTok
- **Pixel ID**: 在 TikTok Events Manager 中获取
- **Access Token**: 在 TikTok Ads Manager 中创建

#### Pinterest
- **Tag ID**: 在 Pinterest Tag Manager 中获取
- **Access Token**: 在 Pinterest Business 中创建

---

## 迁移步骤

### 步骤 1: 风险评估

1. **查看扫描报告**
   - 进入 **扫描** 页面
   - 查看风险等级和优先级
   - 了解依赖关系

2. **制定迁移计划**
   - 根据优先级排序
   - 考虑依赖关系
   - 估算迁移时间

### 步骤 2: 像素迁移

#### 2.1 选择平台

1. 进入 **像素迁移** 页面
2. 选择需要迁移的平台（可多选）
3. 点击 **开始迁移**

#### 2.2 配置凭证

对于每个平台：

1. **输入 API 凭证**
   - 粘贴 Measurement ID / Pixel ID
   - 粘贴 Access Token / API Secret
   - 验证凭证有效性

2. **配置事件映射**
   - 选择要追踪的事件类型
   - 配置事件参数映射
   - 预览事件结构

#### 2.3 环境切换

1. **测试环境**
   - 先在测试环境配置
   - 完成测试订单
   - 验证事件发送

2. **生产环境**
   - 测试通过后切换到生产
   - 监控事件发送状态
   - 确认数据准确性

#### 2.4 保存配置

1. 检查所有配置
2. 点击 **保存并启用**
3. 等待 Web Pixel 创建完成

### 步骤 3: UI 模块迁移

#### 3.1 识别需要迁移的 UI 元素

扫描报告会识别以下 UI 元素：
- 问卷/调查表单
- 订单追踪显示
- 再购按钮
- 客服入口
- 推荐商品

#### 3.2 配置 UI 模块

1. 进入 **UI 模块** 页面
2. 选择要启用的模块
3. 配置模块设置：
   - 显示规则（客户标签、订单金额等）
   - 内容定制（标题、描述、按钮文字）
   - 多语言支持

#### 3.3 预览和发布

1. **预览模块**
   - 在开发商店中预览
   - 检查显示效果
   - 调整配置

2. **发布模块**
   - 确认配置无误
   - 点击 **启用模块**
   - 模块将自动显示在 Thank You / Order Status 页面

### 步骤 4: 验证和测试

#### 4.1 运行验收向导

1. 进入 **验收向导** 页面
2. 点击 **运行验收**
3. 按照测试清单完成测试订单

#### 4.2 验证事件发送

1. **实时监控**
   - 查看实时事件监控
   - 确认事件成功发送
   - 检查参数完整性

2. **对账验证**
   - 查看渠道对账报告
   - 确认 Pixel 和 CAPI 数据一致
   - 检查金额准确性

#### 4.3 生成验收报告

1. 查看验收报告
2. 确认所有测试通过
3. 导出报告（PDF/CSV）

---

## 迁移后验证

### 1. 功能验证

确保以下功能正常工作：

- ✅ 转化事件成功发送到所有配置的平台
- ✅ 事件参数完整（value、currency、items）
- ✅ UI 模块正确显示
- ✅ 事件去重正常工作
- ✅ 客户同意状态正确处理

### 2. 数据验证

#### 2.1 事件对账

1. 完成测试订单
2. 等待 1-2 分钟
3. 查看对账报告
4. 确认 Shopify 订单与平台事件匹配

#### 2.2 金额验证

1. 检查订单金额是否准确
2. 验证币种是否正确
3. 确认商品信息完整

### 3. 监控设置

#### 3.1 配置告警

1. 进入 **设置** > **告警**
2. 配置告警阈值：
   - 失败率阈值（推荐 2%）
   - 缺参率阈值（推荐 5%）
   - 事件量骤降阈值（推荐 50%）

3. 选择通知渠道：
   - 邮件
   - Slack
   - Telegram

#### 3.2 持续监控

1. 定期查看监控面板
2. 关注告警通知
3. 及时处理异常情况

---

## 常见问题

### Q1: 迁移需要多长时间？

**A**: 迁移时间取决于：
- 需要迁移的平台数量
- 配置复杂度
- 测试和验证时间

**估算**：
- 单平台迁移：30-60 分钟
- 多平台迁移：2-4 小时
- 包含 UI 模块：4-8 小时

### Q2: 迁移期间会影响现有追踪吗？

**A**: 不会。迁移过程是并行的：
- 旧追踪代码继续工作
- 新追踪代码同时运行
- 迁移完成后可以移除旧代码

### Q3: 如何确保数据不丢失？

**A**: 
1. 使用事件去重功能
2. 同时运行 Pixel 和 CAPI
3. 监控事件发送状态
4. 定期对账验证

### Q4: 迁移后可以回滚吗？

**A**: 可以。应用支持配置版本管理：
1. 进入像素配置页面
2. 查看版本历史
3. 选择要回滚的版本
4. 点击 **回滚**

### Q5: 如何处理自定义追踪代码？

**A**: 
1. 使用 **手动粘贴** 功能
2. 粘贴自定义代码
3. 应用会自动识别平台和风险
4. 根据建议进行迁移

---

## 故障排除

### 问题 1: 事件发送失败

**症状**: 监控面板显示事件发送失败

**可能原因**:
- API 凭证错误
- 网络连接问题
- 平台 API 限制

**解决方案**:
1. 检查 API 凭证是否正确
2. 查看错误日志
3. 联系平台技术支持

### 问题 2: 参数缺失

**症状**: 验收报告显示参数缺失

**可能原因**:
- 事件映射配置错误
- 订单数据不完整

**解决方案**:
1. 检查事件映射配置
2. 验证订单数据
3. 重新配置事件映射

### 问题 3: UI 模块不显示

**症状**: 配置的模块在 Thank You 页面不显示

**可能原因**:
- 显示规则配置错误
- 模块未正确启用
- Checkout Extensibility 未启用

**解决方案**:
1. 检查显示规则
2. 确认模块已启用
3. 确认店铺已启用 Checkout Extensibility

### 问题 4: 事件重复发送

**症状**: 同一订单的事件被发送多次

**可能原因**:
- 事件去重配置错误
- Event ID 生成问题

**解决方案**:
1. 检查事件去重配置
2. 验证 Event ID 生成逻辑
3. 查看去重冲突报告

---

## 最佳实践

### 1. 分阶段迁移

- **阶段 1**: 迁移核心平台（GA4、Meta）
- **阶段 2**: 迁移次要平台
- **阶段 3**: 迁移 UI 模块
- **阶段 4**: 移除旧代码

### 2. 充分测试

- 在测试环境完成所有测试
- 使用真实订单场景
- 验证所有配置

### 3. 持续监控

- 迁移后持续监控 1-2 周
- 关注告警通知
- 定期对账验证

### 4. 文档记录

- 记录迁移配置
- 保存验收报告
- 记录遇到的问题和解决方案

---

## 获取帮助

如果您在迁移过程中遇到问题：

1. **查看文档**: 阅读用户指南和常见问题
2. **联系支持**: 在应用内提交支持请求
3. **社区论坛**: 访问 Shopify 社区论坛

---

*祝您迁移顺利！如有任何问题，我们随时为您提供帮助。*

