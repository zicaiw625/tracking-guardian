# Learn more: https://shopify.dev/docs/apps/build/online-store/web-pixels

api_version = "2024-10"
type = "web_pixel_extension"
name = "Tracking Guardian Pixel"
runtime_context = "strict"

# Privacy & Consent Configuration (P1-05)
# This pixel respects customer consent and only sends data when allowed
#
# Why marketing=true?
# - We send conversion data to ad platforms (Meta CAPI, TikTok Events, Google GA4)
# - This is for advertising attribution and optimization
# - If a customer denies marketing consent, the pixel will NOT send any data
#
# Why analytics=true?
# - Conversion tracking is also considered analytics
# - Some shops may only use analytics consent (not marketing)
# - We check EITHER marketing OR analytics consent before sending
#
# Merchant Visibility:
# - If a customer denies marketing consent, CAPI data will NOT be sent
# - Merchants should be aware of this in their consent banner settings
# - This is compliant with GDPR and other privacy regulations
[customer_privacy]
  # Analytics: conversion tracking and reporting
  analytics = true
  # Marketing: data sent to ad platforms for optimization
  marketing = true
  # Preferences: not used by this pixel
  preferences = false
  # No sale of data - data is only used for merchant's own tracking
  sale_of_data = "disabled"

# P0-01: Backend URL is hardcoded in the pixel extension for security
# This prevents merchants from configuring arbitrary data exfiltration endpoints
# The production URL is set as a constant in the extension source code

[settings]
  # P0-03: Ingestion Key - used for request association and diagnostics (NOT a security credential)
  # This is NOT a cryptographic secret - it's used for:
  # - Correlating pixel events with webhook events
  # - Filtering noise from invalid requests
  # - Diagnostics and troubleshooting
  [[settings.fields]]
    key = "ingestion_secret"
    name = "Ingestion Key"
    description = "Key for request association and diagnostics (auto-generated). NOT used for security - the security boundary is server-side validation."
    type = "single_line_text_field"

  [[settings.fields]]
    key = "debug"
    name = "Debug Mode"
    description = "Enable debug logging in browser console (disable for production)"
    type = "boolean"
