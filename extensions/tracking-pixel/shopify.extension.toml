api_version = "2025-07"
type = "web_pixel_extension"
name = "Tracking Guardian Pixel"
runtime_context = "strict"

# P0-2: Customer Privacy Configuration (Strict-only for App Store compliance)
# 
# We require both marketing AND analytics consent for the pixel to load.
# This ensures declaration-behavior consistency with runtime logic.
# 
# - analytics = true (required): Needed for checkout tracking
# - marketing = true (required): Needed for conversion tracking to ad platforms  
# - sale_of_data = "enabled": Treated as data sharing, opt-out stops pixel firing
#
# Shopify loads pixel only when ALL required permissions are granted.
# This is the strictest, most compliant configuration.
[customer_privacy]
  analytics = true
  marketing = true
  preferences = false
  sale_of_data = "enabled"

[settings]
  [[settings.fields]]
    key = "ingestion_key"
    name = "Ingestion Key"
    description = "Store-scoped key for event correlation. Auto-generated during app installation."
    type = "single_line_text_field"
  