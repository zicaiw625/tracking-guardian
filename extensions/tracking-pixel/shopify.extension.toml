# Learn more: https://shopify.dev/docs/apps/build/online-store/web-pixels

api_version = "2024-10"
type = "web_pixel_extension"
name = "Tracking Guardian Pixel"
runtime_context = "strict"

# Privacy & Consent Configuration (P1-05)
# This pixel respects customer consent and only sends data when allowed
#
# Why marketing=true?
# - We send conversion data to ad platforms (Meta CAPI, TikTok Events, Google GA4)
# - This is for advertising attribution and optimization
# - If a customer denies marketing consent, the pixel will NOT send any data
#
# Why analytics=true?
# - Conversion tracking is also considered analytics
# - Some shops may only use analytics consent (not marketing)
# - We check EITHER marketing OR analytics consent before sending
#
# Why sale_of_data="enabled"?
# - We share conversion data with third-party ad platforms for attribution
# - This falls under "sale of data" semantics in some jurisdictions (e.g., CCPA)
# - When enabled: if customer opts out of sale_of_data, pixel respects that
# - The pixel code checks saleOfDataAllowed in addition to marketing/analytics
#
# Merchant Visibility:
# - If a customer denies marketing OR sale_of_data consent, CAPI data will NOT be sent
# - Merchants should be aware of this in their consent banner settings
# - This is compliant with GDPR/CCPA and other privacy regulations
[customer_privacy]
  # Analytics: conversion tracking and reporting
  analytics = true
  # Marketing: data sent to ad platforms for optimization
  marketing = true
  # Preferences: not used by this pixel
  preferences = false
  # Sale of data: enabled - we share conversion data with ad platforms
  # If customer opts out, the pixel will NOT send any data
  sale_of_data = "enabled"

# P0-01: Backend URL is hardcoded in the pixel extension for security
# This prevents merchants from configuring arbitrary data exfiltration endpoints
# The production URL is set as a constant in the extension source code

[settings]
  # P0-03: Ingestion Key - used for request association and diagnostics (NOT a security credential)
  # This is NOT a cryptographic secret - it's used for:
  # - Correlating pixel events with webhook events
  # - Filtering noise from invalid requests
  # - Diagnostics and troubleshooting
  [[settings.fields]]
    key = "ingestion_secret"
    name = "Ingestion Key"
    description = "Key for request association and diagnostics (auto-generated). NOT used for security - the security boundary is server-side validation."
    type = "single_line_text_field"
  
  # Note: debug field removed - Shopify settings are always strings (single_line_text_field)
  # and parsing boolean strings correctly across create/update/read cycles is error-prone.
  # For debugging, developers can use browser DevTools to inspect network requests.
