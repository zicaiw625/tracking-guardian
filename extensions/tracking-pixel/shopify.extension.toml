# IMPORTANT: The 'uid' field below MUST be generated by Shopify CLI.
# Run: shopify app deploy
# The CLI will auto-generate and fill in the uid on first deployment.
# DO NOT manually create a fake uid - it will cause webPixelCreate to fail.
#
# If uid is missing after deploy, run: shopify app generate extension --type web_pixel
# and copy the generated uid here, or check .shopify/project.json

api_version = "2025-07"
type = "web_pixel_extension"
name = "Tracking Guardian Pixel"
handle = "tracking-guardian-pixel"
runtime_context = "strict"

# Customer Privacy settings determine when this pixel loads.
# The pixel will ONLY load when ALL required consents are granted.
#
# CURRENT CONFIGURATION (strict mode):
# - analytics = true: Pixel requires analytics consent to load
# - marketing = true: Pixel requires marketing consent to load
# - sale_of_data = "enabled": Pixel respects CCPA sale of data preferences
#
# PRODUCT DECISION REQUIRED:
# This configuration means the pixel only loads when users grant ALL permissions.
# Expected coverage: Lower (only fully consented users)
# Compliance: Maximum protection
#
# ALTERNATIVE OPTIONS:
# 1. If you want opt-out users to still trigger (with LDU/limited data):
#    sale_of_data = "ldu"  (requires implementing LDU logic in pixel code)
# 2. If you want broader coverage at cost of some analytics:
#    analytics = false     (pixel loads without analytics consent)
#
# Reference: https://shopify.dev/docs/api/web-pixels-api/pixel-privacy
[customer_privacy]
analytics = true
marketing = true
preferences = false
sale_of_data = "enabled"

# Settings schema - MUST use type = "object" per Shopify Web Pixel requirements.
# All field types MUST be "single_line_text_field" (only type supported).
# Reference: https://shopify.dev/docs/apps/build/marketing-analytics/build-web-pixels
[settings]
type = "object"

[settings.fields.ingestion_key]
name = "Ingestion Key"
description = "Store-scoped key for event correlation. Auto-generated during app installation."
type = "single_line_text_field"

[settings.fields.shop_domain]
name = "Shop Domain"
description = "The myshopify.com domain for this store. Auto-configured during installation."
type = "single_line_text_field"

[settings.fields.backend_url]
name = "Backend URL"
description = "The Tracking Guardian backend URL for event ingestion. Auto-configured during installation."
type = "single_line_text_field"

[settings.fields.schema_version]
name = "Schema Version"
description = "Settings schema version for forward compatibility. Auto-managed by the app."
type = "single_line_text_field"
